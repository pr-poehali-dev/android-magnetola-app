# Подключение Arduino Nano к приложению

## Что это даёт?

Arduino Nano позволяет подключить дополнительные датчики к вашей автомобильной системе:
- Температура и влажность в салоне (DHT22)
- Атмосферное давление (BMP280)
- Напряжение бортовой сети
- Любые аналоговые датчики (2 канала)

## Необходимое оборудование

1. **Arduino Nano** (оригинал или клон CH340)
2. **USB-кабель** Mini-USB или Micro-USB (в зависимости от версии)
3. **Датчики** (опционально):
   - DHT22 - температура и влажность
   - BMP280 - барометрическое давление
   - Резистивный делитель для измерения напряжения
   - Любые аналоговые датчики

## Схема подключения

```
Arduino Nano:
┌─────────────┐
│   D2  ├──── DHT22 (температура/влажность)
│   A0  ├──── Делитель напряжения (12В → 5В)
│   A1  ├──── Пользовательский датчик 1
│   A2  ├──── Пользовательский датчик 2
│  GND  ├──── Общий минус
│  5V   ├──── Питание датчиков
│  USB  ├──── К Android магнитоле (OTG)
└─────────────┘
```

## Установка

### Шаг 1: Загрузка скетча в Arduino

1. Откройте Arduino IDE
2. Установите необходимые библиотеки:
   - `DHT sensor library` by Adafruit
   - `Adafruit BMP280 Library`
3. Откройте файл `arduino_sensor_reader.ino`
4. Выберите плату: **Tools → Board → Arduino Nano**
5. Выберите процессор: **Tools → Processor → ATmega328P (Old Bootloader)** для клонов
6. Выберите порт: **Tools → Port → COM...**
7. Нажмите **Upload**

### Шаг 2: Подключение к приложению

1. Подключите Arduino Nano к Android магнитоле через USB (с OTG-адаптером если нужно)
2. Откройте приложение
3. Нажмите кнопку **"Подключить Arduino"**
4. Выберите порт Arduino в диалоговом окне браузера
5. Данные начнут отображаться в реальном времени

## Формат данных

Arduino отправляет данные каждую секунду в формате JSON:

```json
{
  "temp": 23.5,
  "hum": 45.2,
  "pres": 101.3,
  "volt": 12.6,
  "c1": 512,
  "c2": 768
}
```

Или в формате CSV (альтернатива):
```
23.5,45.2,101.3,12.6,512,768
```

## Настройка под ваши датчики

### Изменение пинов
Отредактируйте в скетче:
```cpp
#define DHT_PIN 2        // Пин для DHT22
#define VOLTAGE_PIN A0   // Пин для измерения напряжения
#define CUSTOM1_PIN A1   // Пользовательский датчик 1
#define CUSTOM2_PIN A2   // Пользовательский датчик 2
```

### Добавление своих датчиков
Раскомментируйте нужные библиотеки и добавьте код чтения:
```cpp
#include <DHT.h>
DHT dht(DHT_PIN, DHT22);

void setup() {
  dht.begin();
}

void loop() {
  float temperature = dht.readTemperature();
  float humidity = dht.readHumidity();
  // ... отправка данных
}
```

## Питание

⚠️ **Важно**: Arduino потребляет ~50мА + мощность датчиков. Убедитесь что USB-порт магнитолы может обеспечить достаточный ток.

## Поддерживаемые браузеры

Web Serial API поддерживается в:
- ✅ Chrome/Edge на Android 89+
- ✅ Chrome/Edge на Desktop
- ❌ Firefox (пока не поддерживается)
- ❌ Safari (пока не поддерживается)

## Устранение проблем

**Arduino не определяется:**
- Проверьте USB-кабель (должен поддерживать передачу данных)
- Установите драйвер CH340 для клонов Arduino
- Попробуйте другой USB-порт

**Нет данных в приложении:**
- Откройте Serial Monitor в Arduino IDE и проверьте, что данные отправляются
- Убедитесь что скорость 9600 baud
- Проверьте формат JSON на корректность

**Неправильные значения:**
- Калибруйте датчики
- Для напряжения: настройте делитель правильно (R1=10kΩ, R2=4.7kΩ для 12В → 5В)
